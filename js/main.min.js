$(document).ready(function(){function y(a){a.preventDefault();l.classList.add("d-none");l.setAttribute("aria-live","off");var b=!1,e=!1,u=function(){b&&e&&l.setAttribute("aria-live","assertive")};a=a.currentTarget;var h=a.getAttribute("data-address"),d=a.getAttribute("data-street-number"),g=a.getAttribute("data-street-name-full"),t=a.getAttribute("data-ward"),v=a.getAttribute("data-poll");document.getElementById("addressDetails--address").innerText=h;document.getElementById("addressDetails--ward").innerText=
t;document.getElementById("addressDetails--poll").innerText=v;var q=document.getElementById("votingLocations--electionDay");q.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-pulse"></i></li>';var k=document.getElementById("votingLocations--advanced");k.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-pulse"></i></li>';var n="https://www.google.com/maps/dir/"+encodeURIComponent(h)+"/";$.get("voterView.asp",{method:"find_voting_locations",streetNumber:d,
streetName:g,ward:t,poll:v},"json").done(function(a){k.innerHTML="";0===a.length?q.innerHTML='<li class="list-group-item list-group-item-warning">No voting location found.</li>':(q.innerHTML="",a.forEach(function(a){var b=n+encodeURIComponent(a.Address1+", "+a.City+", "+a.Province+" "+a.PostalCode),b='<li class="list-group-item"><div class="row">'+('<p class="col-sm my-0" aria-label="Voting location date and time">'+a.DateOpenStringLocal+"<br />"+a.StartTime+" to "+a.EndTime+"</p>")+('<p class="col-sm my-0" aria-label="Votting location address">'+
(""===a.LocationName?"":a.LocationName+"<br />")+'<a href="'+b+'" title="Find this Location" target="_blank">'+a.Address1+"</a>"+(""===a.Address2?"":"<br />"+a.Address2)+"</p>")+"</div></li>";a.IsAdvancePoll?k.insertAdjacentHTML("beforeend",b):q.insertAdjacentHTML("beforeend",b)}));b=!0;u()});var p=document.getElementById("candidateList--listGroups");p.innerHTML='<p>Loading... <i class="fas fa-spinner fa-pulse"></i></p>';var r=function(a,b){var c=b.CandidateName,e=b.CandidateName.split(",");2===e.length&&
(c=e[1].trim()+" "+e[0]);return a+'<li class="list-group-item">'+c+"</li>"};$.get("voterView.asp",{method:"candidate_list",ward:t},"json").done(function(a){p.innerHTML=a.Positions.reduce(function(a,b,c){return a+'<h4 class="clearfix mt-2"><span class="float-left" id="candidateList--'+c+'_label">'+b.PositionName+'</span> <small class="float-right"><span class="badge badge-secondary">'+b.Candidates.length+" candidate"+(1===b.Candidates.length?"":"s")+'</span> <span class="badge badge-secondary">'+b.NumberPositions+
" position"+(1===b.NumberPositions?"":"s")+"</span></small></h4>"+('<ul class="list-group" aria-labelledby="candidateList--'+c+'_label">'+b.Candidates.reduce(r,"")+"</ul>")},"");e=!0;u()});w=!0;l.classList.remove("d-none");f.classList.add("d-none");c.setAttribute("aria-expanded","false");c.value=h;c.setCustomValidity("");m=h.toLowerCase();d=f.getElementsByTagName("button");for(g=0;g<d.length;g+=1)d[g].getAttribute("data-address")!==h&&(d[g].outerHTML="",--g);a.setAttribute("aria-selected","true");
c.setAttribute("aria-activedescendant",a.id)}function z(a){var b=a.currentTarget;switch(a.key){case "ArrowDown":b.setAttribute("aria-selected","false");(a=b.nextElementSibling)?a.focus():(c.focus(),a=f.getElementsByTagName("button")[0]);a.setAttribute("aria-selected","true");c.setAttribute("aria-activedescendant",a.id);break;case "ArrowUp":b.setAttribute("aria-selected","false"),(a=b.previousElementSibling)?(a.focus(),a.setAttribute("aria-selected","true"),c.setAttribute("aria-activedescendant",a.id)):
c.focus()}}function k(){var a=c.value.trim().toLowerCase();c.removeAttribute("aria-activedescendant");if(""===a)m=a,f.innerHTML='<div class="list-group-item list-group-item-info" role="alert">To get started, enter your address.<br /><em>i.e. 99 Foster Dr</em></div>';else if(m!==a)if(n&&0===a.indexOf(m))f.innerHTML='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>';
else if(m=a,p.test(a.charAt(0))){var b=r.getElementsByTagName("i")[0];b.classList.add("fa-spinner");b.classList.remove("fa-times");b.classList.add("fa-pulse");n=!1;$.get("voterView.asp",{method:"street_addresses",query:a},"json").done(function(a){if(0===a.length)f.innerHTML='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>',n=!0;else{var e=!1,h=0;
f.innerHTML=a.reduce(function(a,b,c){if(null===b.StreetNumber)return a;e=!0;h+=1;var d=(b.StreetName+" "+b.StreetType+" "+b.StreetDirection).trim();return a+'<button class="list-group-item list-group-item-action clearfix" id="addressResults--'+c+'" data-address="'+b.Address+'" data-street-number="'+b.StreetNumber+'" data-street-name="'+b.StreetName+'" data-street-name-full="'+d+'" data-ward="'+b.Ward+'" data-poll="'+b.PollAndSuffix+'" role="option" type="button" aria-posinset="'+h+'" aria-selected="false" aria-label="'+
b.Address+'"><strong class="float-left">'+b.Address+"</strong>"+('<small class="float-right text-right">Ward '+b.Ward+"<br />Poll "+b.PollAndSuffix+"</small>")+"</button>"},"");if(e){a=f.getElementsByTagName("button");var d;for(d=0;d<a.length;d+=1)a[d].addEventListener("click",y),a[d].addEventListener("keyup",z),0===d&&(a[d].setAttribute("aria-selected","true"),c.setAttribute("aria-activedescendant",a[d].id))}else f.innerHTML='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>'}b.classList.remove("fa-pulse");
b.classList.add("fa-times");b.classList.remove("fa-spinner")}).fail(function(){try{window.console.log("An error occurred communicating with VoterView.")}catch(e){}})}else f.innerHTML='<div class="list-group-item list-group-item-danger">Be sure to use a complete residential address with the civic number first.</div>'}function x(){f.classList.remove("d-none");w&&l.classList.add("d-lg-block");l.classList.add("d-none");c.setAttribute("aria-expanded","true")}var w=!1,c=document.getElementById("addressForm--query"),
r=document.getElementById("addressForm--resetBtn"),f=document.getElementById("addressResults");document.getElementById("addressResults-message");var l=document.getElementById("addressDetails"),p=/\d/,m="",n=!1,A=function(a,b,c){var e;return function(){var f=this,d=arguments,g=c&&!e;window.clearTimeout(e);e=window.setTimeout(function(){e=null;c||a.apply(f,d)},b);g&&a.apply(f,d)}}(k,200);document.getElementById("addressForm").addEventListener("submit",function(a){a.preventDefault()});r.addEventListener("click",
function(a){a.preventDefault();c.value="";c.focus();k()});c.addEventListener("focus",x);c.addEventListener("keyup",function(a){x();switch(a.key){case "ArrowDown":case "ArrowUp":a=f.getElementsByTagName("button");var b;for(b=0;b<a.length;b+=1)0===b?(a[b].focus(),a[b].setAttribute("aria-selected","true"),c.setAttribute("aria-activedescendant",a[b].id)):a[b].setAttribute("aria-selected","false");return;case "Enter":if(a=c.getAttribute("aria-activedescendant"))try{document.getElementById(a).click()}catch(e){}}a=
c.value.trim();try{0===a.length||p.test(a.charAt(0))?(c.setCustomValidity(""),A()):c.setCustomValidity("Addresses should include civic number first.")}catch(e){}});k();document.getElementById("siteContainer").style.display="block";$("#modal--register").on("show.bs.modal",function(){document.getElementById("register--iframe").setAttribute("src","https://vrp.voterview.ca/g/"+document.body.getAttribute("data-county-mun"));try{iFrameResize()}catch(a){}})});
