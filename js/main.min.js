$(document).ready(function(){function u(a){a.preventDefault();m.classList.add("d-none");var b=a.currentTarget;a=b.getAttribute("data-address");var f=b.getAttribute("data-street-number"),d=b.getAttribute("data-street-name-full"),q=b.getAttribute("data-ward"),b=b.getAttribute("data-poll");document.getElementById("addressDetails--address").innerText=a;document.getElementById("addressDetails--ward").innerText=q;document.getElementById("addressDetails--poll").innerText=b;var g=document.getElementById("votingLocations--electionDay");
g.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-pulse"></i></li>';var p=document.getElementById("votingLocations--advanced");p.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-pulse"></i></li>';var l="https://www.google.com/maps/dir/"+encodeURIComponent(a)+"/";$.get("voterView.asp",{method:"find_voting_locations",streetNumber:f,streetName:d},"json").done(function(a){p.innerHTML="";0===a.length?g.innerHTML='<li class="list-group-item list-group-item-warning">No voting location found.</li>':
(g.innerHTML="",a.forEach(function(a){var b=l+encodeURIComponent(a.Address1+", "+a.City+", "+a.Province+" "+a.PostalCode),b='<li class="list-group-item"><div class="row">'+('<div class="col-sm">'+a.DateOpenStringLocal+"<br />"+a.StartTime+" to "+a.EndTime+"</div>")+('<div class="col-sm">'+(""===a.LocationName?"":a.LocationName+"<br />")+'<a href="'+b+'" title="Find this Location" target="_blank">'+a.Address1+"</a>"+(""===a.Address2?"":"<br />"+a.Address2)+"</div>")+"</div></li>";a.IsAdvancePoll?p.insertAdjacentHTML("beforeend",
b):g.insertAdjacentHTML("beforeend",b)}))});var h=document.getElementById("candidateList--listGroups");h.innerHTML='<p>Loading... <i class="fas fa-spinner fa-pulse"></i></p>';var n=function(a,b){return a+'<li class="list-group-item">'+b.CandidateName+"</li>"};$.get("voterView.asp",{method:"candidate_list",ward:q},"json").done(function(a){h.innerHTML=a.Positions.reduce(function(a,b){return a+'<h4 class="clearfix mt-2"><span class="float-left">'+b.PositionName+'</span> <small class="float-right"><span class="badge badge-secondary">'+
b.Candidates.length+" candidate"+(1===b.Candidates.length?"":"s")+'</span> <span class="badge badge-secondary">'+b.NumberPositions+" position"+(1===b.NumberPositions?"":"s")+'</span></small></h4><ul class="list-group">'+b.Candidates.reduce(n,"")+"</ul>"},"")});r=!0;m.classList.remove("d-none");e.classList.add("d-none");c.value=a;c.setCustomValidity("");k=a.toLowerCase();f=e.getElementsByTagName("button");for(d=0;d<f.length;d+=1)f[d].getAttribute("data-address")!==a&&(f[d].outerHTML="",--d)}function l(){var a=
c.value.trim().toLowerCase();if(""===a)k=a,e.innerHTML='<div class="list-group-item list-group-item-info">To get started, enter your address.<br /><em>i.e. 99 Foster Dr</em></div>';else if(k!==a)if(h&&0===a.indexOf(k))e.innerHTML='<div class="list-group-item list-group-item-danger"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>';else if(k=a,n.test(a.charAt(0))){var b=t.getElementsByTagName("i")[0];b.classList.add("fa-spinner");
b.classList.remove("fa-times");b.classList.add("fa-pulse");h=!1;$.get("voterView.asp",{method:"street_addresses",query:a},"json").done(function(a){if(0===a.length)e.innerHTML='<div class="list-group-item list-group-item-danger"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>',h=!0;else{var d=!1;e.innerHTML=a.reduce(function(a,b){if(null===b.StreetNumber)return a;d=!0;var c=(b.StreetName+" "+b.StreetType+" "+b.StreetDirection).trim();
return a+'<button class="list-group-item list-group-item-action" data-address="'+b.Address+'" data-street-number="'+b.StreetNumber+'" data-street-name="'+b.StreetName+'" data-street-name-full="'+c+'" data-ward="'+b.Ward+'" data-poll="'+b.PollAndSuffix+'" type="button"><div class="clearfix"><strong class="float-left">'+b.Address+"</strong>"+('<small class="float-right text-right">Ward '+b.Ward+"<br />Poll "+b.PollAndSuffix+"</small>")+"</div></button>"},"");if(d){a=e.getElementsByTagName("button");
var c;for(c=0;c<a.length;c+=1)a[c].addEventListener("click",u)}else e.innerHTML='<div class="list-group-item list-group-item-danger"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>'}b.classList.remove("fa-pulse");b.classList.add("fa-times");b.classList.remove("fa-spinner")}).fail(function(){try{window.console.log("An error occurred communicating with VoterView.")}catch(f){}})}else e.innerHTML='<div class="list-group-item list-group-item-danger">Be sure to use a complete residential address with the civic number first.</div>'}
var r=!1,c=document.getElementById("addressForm--query"),t=document.getElementById("addressForm--resetBtn"),e=document.getElementById("addressResults"),m=document.getElementById("addressDetails"),n=/\d/,k="",h=!1;document.getElementById("addressForm").addEventListener("submit",function(a){a.preventDefault()});t.addEventListener("click",function(a){a.preventDefault();c.value="";c.focus();l()});c.addEventListener("focus",function(){e.classList.remove("d-none");r&&m.classList.add("d-lg-block");m.classList.add("d-none")});
c.addEventListener("input",function(){var a=c.value.trim();try{0===a.length||n.test(c.value.charAt(0))?c.setCustomValidity(""):c.setCustomValidity("Addresses should include civic number first.")}catch(b){}});c.addEventListener("keyup",function(a,b,c){var d;return function(){var e=this,g=arguments,f=c&&!d;window.clearTimeout(d);d=window.setTimeout(function(){d=null;c||a.apply(e,g)},b);f&&a.apply(e,g)}}(l,200));l();document.getElementById("siteContainer").style.display="block";$("#modal--register").on("show.bs.modal",
function(){document.getElementById("register--iframe").setAttribute("src","https://vrp.voterview.ca/g/"+document.body.getAttribute("data-county-mun"));try{iFrameResize()}catch(a){}})});
