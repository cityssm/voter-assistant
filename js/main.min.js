$(document).ready(function(){"use strict";function e(e,t,s){let a;return function(){let i=this,n=arguments,r=function(){a=null,s||e.apply(i,n)},d=s&&!a;window.clearTimeout(a),a=window.setTimeout(r,t),d&&e.apply(i,n)}}function t(e){e.preventDefault(),l.classList.add("d-none"),l.setAttribute("aria-live","off");let t=!1,s=!1;const a=function(){t&&s&&l.setAttribute("aria-live","assertive")},i=e.currentTarget,d=i.getAttribute("data-address"),m=i.getAttribute("data-street-number"),f=i.getAttribute("data-street-name-full"),b=i.getAttribute("data-ward"),p=i.getAttribute("data-poll");document.getElementById("addressDetails--address").innerText=d,document.getElementById("addressDetails--ward").innerText=b,document.getElementById("addressDetails--poll").innerText=p;{const e=document.getElementById("votingLocations--electionDay");e.innerHTML=u;const s=document.getElementById("votingLocations--advanced");s.innerHTML=u;const i="https://www.google.com/maps/dir/"+encodeURIComponent(d)+"/";$.get("voterView.asp",{method:"find_voting_locations",streetNumber:m,streetName:f,ward:b,poll:p},"json").done(function(n){s.innerHTML="",0===n.length?e.innerHTML='<li class="list-group-item list-group-item-warning">No voting location found.</li>':(e.innerHTML="",n.forEach(function(t){let a=i+encodeURIComponent(t.Address1+", "+t.City+", "+t.Province+" "+t.PostalCode),n='<li class="list-group-item"><div class="row"><p class="col-sm my-0" aria-label="Voting location date and time">'+t.DateOpenStringLocal+"<br />"+t.StartTime+" to "+t.EndTime+'</p><p class="col-sm my-0" aria-label="Votting location address">'+(""===t.LocationName?"":t.LocationName+"<br />")+'<a class="span-link" href="'+a+'" title="Find this Location" target="_blank"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> <span>'+t.Address1+"</span></a>"+(""===t.Address2?"":"<br />"+t.Address2)+"</p></div></li>";t.IsAdvancePoll?s.insertAdjacentHTML("beforeend",n):e.insertAdjacentHTML("beforeend",n)})),t=!0,a()})}{const e=document.getElementById("candidateList--listGroups");e.innerHTML="<p>"+c+"</p>";const t=function(e,t){let s=t.CandidateName;const a=t.CandidateName.split(",");return 2===a.length&&(s=a[1].trim()+" "+a[0]),e+'<li class="list-group-item">'+s+"</li>"};$.get("voterView.asp",{method:"candidate_list",ward:b},"json").done(function(i){e.innerHTML=i.Positions.reduce(function(e,s,a){return 0===s.Candidates.length?e:e+'<h4 class="clearfix mt-2"><span class="float-left" id="candidateList--'+a+'_label">'+s.PositionName+'</span> <small class="float-right"><span class="badge badge-secondary">'+s.Candidates.length+" candidate"+(1===s.Candidates.length?"":"s")+'</span> <span class="badge badge-secondary">'+s.NumberPositions+" position"+(1===s.NumberPositions?"":"s")+'</span></small></h4><ul class="list-group" aria-labelledby="candidateList--'+a+'_label">'+s.Candidates.reduce(t,"")+"</ul>"},""),s=!0,a()})}n=!0,l.classList.remove("d-none"),o.classList.add("d-none"),r.setAttribute("aria-expanded","false"),r.value=d,r.setCustomValidity(""),g=d.toLowerCase();const v=o.getElementsByTagName("button");let y;for(y=0;y<v.length;y+=1)v[y].getAttribute("data-address")!==d&&(v[y].outerHTML="",y-=1);i.setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",i.id)}function s(e){const t=e.currentTarget;switch(e.key){case"ArrowDown":t.setAttribute("aria-selected","false");const s=t.nextElementSibling;if(s)s.focus(),s.setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",s.id);else{r.focus();const e=o.getElementsByTagName("button")[0];e.setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",e.id)}break;case"ArrowUp":t.setAttribute("aria-selected","false");const a=t.previousElementSibling;a?(a.focus(),a.setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",a.id)):r.focus()}}function a(){const e=r.value.trim().toLowerCase();if(r.removeAttribute("aria-activedescendant"),""===e)return g=e,void(o.innerHTML='<div class="list-group-item list-group-item-info" role="alert">To get started, enter your address.<br /><em>i.e. 99 Foster Dr</em></div>');if(g!==e){const a='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>';if(f&&0===e.indexOf(g))return void(o.innerHTML=a);if(g=e,!m.test(e.charAt(0)))return void(o.innerHTML='<div class="list-group-item list-group-item-danger">Be sure to use a complete residential address with the civic number first.</div>');const i=d.getElementsByTagName("i")[0];i.classList.add("fa-spinner"),i.classList.remove("fa-times"),i.classList.add("fa-pulse"),f=!1,$.get("voterView.asp",{method:"street_addresses",query:e},"json").done(function(e){if(0===e.length)o.innerHTML=a,f=!0;else{let i=!1,n=0;if(o.innerHTML=e.reduce(function(e,t,s){if(null===t.StreetNumber)return e;i=!0,n+=1;const a=(t.StreetName+" "+t.StreetType+" "+t.StreetDirection).trim();return e+'<button class="list-group-item list-group-item-action clearfix" id="addressResults--'+s+'" data-address="'+t.Address+'" data-street-number="'+t.StreetNumber+'" data-street-name="'+t.StreetName+'" data-street-name-full="'+a+'" data-ward="'+t.Ward+'" data-poll="'+t.PollAndSuffix+'" role="option" type="button" aria-posinset="'+n+'" aria-selected="false" aria-label="'+t.Address+'"><strong class="float-left">'+t.Address+'</strong><small class="float-right text-right">Ward '+t.Ward+"<br />Poll "+t.PollAndSuffix+"</small></button>"},""),i){const e=o.getElementsByTagName("button");let a;for(a=0;a<e.length;a+=1)e[a].addEventListener("click",t),e[a].addEventListener("keyup",s),0===a&&(e[a].setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",e[a].id))}else o.innerHTML=a}i.classList.remove("fa-pulse"),i.classList.add("fa-times"),i.classList.remove("fa-spinner")}).fail(function(){try{window.console.log("An error occurred communicating with VoterView.")}catch(e){}})}}function i(){o.classList.remove("d-none"),n&&l.classList.add("d-lg-block"),l.classList.add("d-none"),r.setAttribute("aria-expanded","true")}let n=!1;const r=document.getElementById("addressForm--query"),d=document.getElementById("addressForm--resetBtn"),o=document.getElementById("addressResults"),l=document.getElementById("addressDetails"),c='Loading... <i class="fas fa-spinner fa-pulse" aria-hidden="true"></i>',u='<li class="list-group-item">'+c+"</li>",m=/\d/;let g="",f=!1;const b=e(a,200);document.getElementById("addressForm").addEventListener("submit",function(e){e.preventDefault()}),d.addEventListener("click",function(e){e.preventDefault(),r.value="",r.focus(),a()}),r.addEventListener("focus",i),r.addEventListener("keyup",function(e){switch(i(),e.key){case"ArrowDown":case"ArrowUp":const t=o.getElementsByTagName("button");let s;for(s=0;s<t.length;s+=1)0===s?(t[s].focus(),t[s].setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",t[s].id)):t[s].setAttribute("aria-selected","false");return;case"Enter":const a=r.getAttribute("aria-activedescendant");if(a)try{document.getElementById(a).click()}catch(e){}}const t=r.value.trim();try{0===t.length||m.test(t.charAt(0))?(r.setCustomValidity(""),b()):r.setCustomValidity("Addresses should include civic number first.")}catch(e){}}),a(),document.getElementById("siteContainer").style.display="block",$("#modal--register").on("show.bs.modal",function(){const e=document.getElementById("register--iframe");e.setAttribute("src","https://ovs.voterview.ca/"+document.body.getAttribute("data-county-mun"));try{iFrameResize({checkOrigin:!1})}catch(e){}}),$("#modal--voteByMail").on("show.bs.modal",function(){const e=document.getElementById("voteByMail--iframe");e.setAttribute("src","https://vrp.voterview.ca/g/"+document.body.getAttribute("data-county-mun")+"?a=1");try{iFrameResize({checkOrigin:!1})}catch(e){}})});