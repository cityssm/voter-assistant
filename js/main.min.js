(function(){function l(a){a.preventDefault();h.classList.add("d-none");var b=a.currentTarget;a=b.getAttribute("data-address");var g=b.getAttribute("data-street-number"),c=b.getAttribute("data-street-name"),m=b.getAttribute("data-ward"),b=b.getAttribute("data-poll");document.getElementById("addressDetails--address").innerText=a;document.getElementById("addressDetails--ward").innerText=m;document.getElementById("addressDetails--poll").innerText=b;var k=document.getElementById("votingLocations--electionDay");
k.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-spin"></i></li>';var e=document.getElementById("votingLocations--advanced");e.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-spin"></i></li>';$.get("voterView.asp",{method:"find_voting_locations",streetNumber:g,streetName:c},"json").done(function(a){e.innerHTML="";0===a.length?k.innerHTML='<li class="list-group-item list-group-item-warning">No voting location found.</li>':(k.innerHTML="",
a.forEach(function(a){var b='<li class="list-group-item"><div class="row">'+('<div class="col-sm">'+a.DateOpenStringLocal+"<br />"+a.StartTime+" to "+a.EndTime+"</div>")+('<div class="col-sm">'+(""===a.LocationName?"":a.LocationName+"<br />")+'<a href="'+a.MapLink+'" title="Find this Location" target="_blank">'+a.Address1+"</a>"+(""===a.Address2?"":"<br />"+a.Address2)+"</div>")+"</div></li>";a.IsAdvancePoll?e.insertAdjacentHTML("beforeend",b):k.insertAdjacentHTML("beforeend",b)}))});var n=document.getElementById("candidateList--listGroups");
n.innerHTML='<p>Loading... <i class="fas fa-spinner fa-spin"></i></p>';var l=function(a,b){return a+'<li class="list-group-item">'+b.CandidateName+"</li>"};$.get("voterView.asp",{method:"candidate_list",ward:m},"json").done(function(a){n.innerHTML=a.Positions.reduce(function(a,b){return a+'<h4 class="clearfix mt-2"><span class="float-left">'+b.PositionName+'</span> <small class="float-right"><span class="badge badge-secondary">'+b.Candidates.length+" candidate"+(1===b.Candidates.length?"":"s")+'</span> <span class="badge badge-secondary">'+
b.NumberPositions+" position"+(1===b.NumberPositions?"":"s")+'</span></small></h4><ul class="list-group">'+b.Candidates.reduce(l,"")+"</ul>"},"")});p=!0;h.classList.remove("d-none");d.classList.add("d-none");f.value=a;g=d.getElementsByTagName("button");for(c=0;c<g.length;c+=1)g[c].getAttribute("data-address")!==a&&(g[c].outerHTML="",--c)}function e(){var a=f.value;0===a.length?d.innerHTML='<div class="list-group-item list-group-item-info">To get started, enter your address.</div>':$.get("voterView.asp",
{method:"street_addresses",query:a},"json").done(function(a){if(0===a.length)d.innerHTML='<div class="list-group-item list-group-item-danger">There are no addresses available.</div>';else{d.innerHTML=a.reduce(function(a,b){return a+'<button class="list-group-item list-group-item-action" data-address="'+b.Address+'" data-street-number="'+b.StreetNumber+'" data-street-name="'+b.StreetName+'" data-ward="'+b.Ward+'" data-poll="'+b.PollAndSuffix+'" type="button"><div class="clearfix"><strong class="float-left">'+
b.Address+"</strong>"+('<small class="float-right text-right">Ward '+b.Ward+"<br />Poll "+b.PollAndSuffix+"</small>")+"</div></button>"},"");a=d.getElementsByTagName("button");var b;for(b=0;b<a.length;b+=1)a[b].addEventListener("click",l)}}).fail(function(){window.alert("An error occurred communicating with VoterView.  Please refresh your browser and try again.")})}var p=!1,f=document.getElementById("addressForm--query"),d=document.getElementById("addressResults"),h=document.getElementById("addressDetails");
document.getElementById("addressForm").addEventListener("submit",function(a){a.preventDefault()});document.getElementById("addressForm--resetBtn").addEventListener("click",function(a){a.preventDefault();f.value="";f.focus();e()});f.addEventListener("focus",function(){d.classList.remove("d-none");p&&h.classList.add("d-md-block");h.classList.add("d-none")});f.addEventListener("keyup",function(a){a.preventDefault();e()});e();$("#modal--register").on("show.bs.modal",function(){document.getElementById("register--iframe").setAttribute("src",
"https://vrp.voterview.ca/g/"+document.body.getAttribute("data-county-mun"))})})();
