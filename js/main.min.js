$(document).ready(function(){function x(a){a.preventDefault();k.classList.add("d-none");k.setAttribute("aria-live","off");var b=!1,l=!1,m=function(){b&&l&&k.setAttribute("aria-live","assertive")};a=a.currentTarget;var f=a.getAttribute("data-address"),d=a.getAttribute("data-street-number"),g=a.getAttribute("data-street-name-full"),v=a.getAttribute("data-ward"),p=a.getAttribute("data-poll");document.getElementById("addressDetails--address").innerText=f;document.getElementById("addressDetails--ward").innerText=
v;document.getElementById("addressDetails--poll").innerText=p;var r=document.getElementById("votingLocations--electionDay");r.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-pulse"></i></li>';var h=document.getElementById("votingLocations--advanced");h.innerHTML='<li class="list-group-item">Loading... <i class="fas fa-spinner fa-pulse"></i></li>';var t="https://www.google.com/maps/dir/"+encodeURIComponent(f)+"/";$.get("voterView.asp",{method:"find_voting_locations",streetNumber:d,
streetName:g},"json").done(function(a){h.innerHTML="";0===a.length?r.innerHTML='<li class="list-group-item list-group-item-warning">No voting location found.</li>':(r.innerHTML="",a.forEach(function(a){var b=t+encodeURIComponent(a.Address1+", "+a.City+", "+a.Province+" "+a.PostalCode),b='<li class="list-group-item"><div class="row">'+('<div class="col-sm">'+a.DateOpenStringLocal+"<br />"+a.StartTime+" to "+a.EndTime+"</div>")+('<div class="col-sm">'+(""===a.LocationName?"":a.LocationName+"<br />")+
'<a href="'+b+'" title="Find this Location" target="_blank">'+a.Address1+"</a>"+(""===a.Address2?"":"<br />"+a.Address2)+"</div>")+"</div></li>";a.IsAdvancePoll?h.insertAdjacentHTML("beforeend",b):r.insertAdjacentHTML("beforeend",b)}));b=!0;m()});var q=document.getElementById("candidateList--listGroups");q.innerHTML='<p>Loading... <i class="fas fa-spinner fa-pulse"></i></p>';var u=function(a,b){return a+'<li class="list-group-item">'+b.CandidateName+"</li>"};$.get("voterView.asp",{method:"candidate_list",
ward:v},"json").done(function(a){q.innerHTML=a.Positions.reduce(function(a,b){return a+'<h4 class="clearfix mt-2"><span class="float-left">'+b.PositionName+'</span> <small class="float-right"><span class="badge badge-secondary">'+b.Candidates.length+" candidate"+(1===b.Candidates.length?"":"s")+'</span> <span class="badge badge-secondary">'+b.NumberPositions+" position"+(1===b.NumberPositions?"":"s")+'</span></small></h4><ul class="list-group">'+b.Candidates.reduce(u,"")+"</ul>"},"");l=!0;m()});w=
!0;k.classList.remove("d-none");e.classList.add("d-none");c.value=f;c.setCustomValidity("");n=f.toLowerCase();d=e.getElementsByTagName("button");for(g=0;g<d.length;g+=1)d[g].getAttribute("data-address")!==f&&(d[g].outerHTML="",--g);a.setAttribute("aria-selected","true");c.setAttribute("aria-activedescendant",a.id)}function y(a){var b=a.currentTarget;switch(a.key){case "ArrowDown":b.setAttribute("aria-selected","false");(a=b.nextElementSibling)?a.focus():(c.focus(),a=e.getElementsByTagName("button")[0]);
a.setAttribute("aria-selected","true");c.setAttribute("aria-activedescendant",a.id);break;case "ArrowUp":b.setAttribute("aria-selected","false"),(a=b.previousElementSibling)?(a.focus(),a.setAttribute("aria-selected","true"),c.setAttribute("aria-activedescendant",a.id)):c.focus()}}function p(){var a=c.value.trim().toLowerCase();c.removeAttribute("aria-activedescendant");if(""===a)n=a,e.innerHTML='<div class="list-group-item list-group-item-info" role="alert">To get started, enter your address.<br /><em>i.e. 99 Foster Dr</em></div>';
else if(n!==a)if(h&&0===a.indexOf(n))e.innerHTML='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>';else if(n=a,t.test(a.charAt(0))){var b=q.getElementsByTagName("i")[0];b.classList.add("fa-spinner");b.classList.remove("fa-times");b.classList.add("fa-pulse");h=!1;$.get("voterView.asp",{method:"street_addresses",query:a},"json").done(function(a){if(0===
a.length)e.innerHTML='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>',h=!0;else{var m=!1,f=0;e.innerHTML=a.reduce(function(a,b,c){if(null===b.StreetNumber)return a;m=!0;f+=1;var d=(b.StreetName+" "+b.StreetType+" "+b.StreetDirection).trim();return a+'<button class="list-group-item list-group-item-action" id="addressResults--'+c+'" data-address="'+
b.Address+'" data-street-number="'+b.StreetNumber+'" data-street-name="'+b.StreetName+'" data-street-name-full="'+d+'" data-ward="'+b.Ward+'" data-poll="'+b.PollAndSuffix+'" role="option" type="button" aria-posinset="'+f+'" aria-selected="false" aria-label="'+b.Address+'"><div class="clearfix"><strong class="float-left">'+b.Address+"</strong>"+('<small class="float-right text-right">Ward '+b.Ward+"<br />Poll "+b.PollAndSuffix+"</small>")+"</div></button>"},"");if(m){a=e.getElementsByTagName("button");
var d;for(d=0;d<a.length;d+=1)a[d].addEventListener("click",x),a[d].addEventListener("keyup",y),0===d&&(a[d].setAttribute("aria-selected","true"),c.setAttribute("aria-activedescendant",a[d].id))}else e.innerHTML='<div class="list-group-item list-group-item-danger" role="alert"><strong>There are no addresses available.</strong><br />Be sure to use a complete residential address with the civic number first.</div>'}b.classList.remove("fa-pulse");b.classList.add("fa-times");b.classList.remove("fa-spinner")}).fail(function(){try{window.console.log("An error occurred communicating with VoterView.")}catch(l){}})}else e.innerHTML=
'<div class="list-group-item list-group-item-danger">Be sure to use a complete residential address with the civic number first.</div>'}function u(){e.classList.remove("d-none");w&&k.classList.add("d-lg-block");k.classList.add("d-none")}var w=!1,c=document.getElementById("addressForm--query"),q=document.getElementById("addressForm--resetBtn"),e=document.getElementById("addressResults"),k=document.getElementById("addressDetails"),t=/\d/,n="",h=!1,z=function(a,b,c){var e;return function(){var f=this,
d=arguments,g=c&&!e;window.clearTimeout(e);e=window.setTimeout(function(){e=null;c||a.apply(f,d)},b);g&&a.apply(f,d)}}(p,200);document.getElementById("addressForm").addEventListener("submit",function(a){a.preventDefault()});q.addEventListener("click",function(a){a.preventDefault();c.value="";c.focus();p()});c.addEventListener("focus",u);c.addEventListener("keyup",function(a){u();switch(a.key){case "ArrowDown":case "ArrowUp":a=e.getElementsByTagName("button");var b;for(b=0;b<a.length;b+=1)0===b?(a[b].focus(),
a[b].setAttribute("aria-selected","true"),c.setAttribute("aria-activedescendant",a[b].id)):a[b].setAttribute("aria-selected","false");return;case "Enter":if(a=c.getAttribute("aria-activedescendant"))try{document.getElementById(a).click()}catch(l){}}a=c.value.trim();try{0===a.length||t.test(a.charAt(0))?(c.setCustomValidity(""),z()):c.setCustomValidity("Addresses should include civic number first.")}catch(l){}});p();document.getElementById("siteContainer").style.display="block";$("#modal--register").on("show.bs.modal",
function(){document.getElementById("register--iframe").setAttribute("src","https://vrp.voterview.ca/g/"+document.body.getAttribute("data-county-mun"));try{iFrameResize()}catch(a){}})});
